### 1. 下書き保存機能の概要

下書き保存機能を実装することで、ユーザーはフォームに入力したデータをデータベースやSharePointリスト、またはその他のデータソースに一時保存できるようになります。

### 2. 必要なコンポーネント

- **データソース**: 下書きデータを保存するためのデータベースやSharePointリスト。
- **ユーザーインターフェイス**: ユーザーがデータを入力するフォームと、下書きを保存するための「保存」ボタン。
- **ロジック**: 下書きデータの保存と読み込みを管理するためのPowerAppsの式と関数。

### 3. 下書き保存機能の実装手順

#### ステップ1: データソースの準備

1. **データソースの作成**: まず、下書きデータを保存するためのデータソース（例: SharePointリスト）を準備します。このリストには、ユーザーがフォームに入力する全てのフィールドを含める必要があります。

#### ステップ2: ユーザーインターフェイスの設計

1. **フォームの作成**: ユーザーがデータを入力するフォームを設計します。PowerAppsのフォームコントロールを使用して、必要なフィールドを含めます。
2. **保存ボタンの追加**: フォームの近くに「保存」ボタンを配置します。このボタンが押されたときに、下書きデータをデータソースに保存するアクションをトリガーします。

#### ステップ3: 下書き保存ロジックの実装

1. **保存ボタンのアクション設定**: 「保存」ボタンの`OnSelect`プロパティに、下記のような式を設定します。これは、ユーザーがフォームに入力したデータをデータソースに保存するためのものです。

```powerapps
Patch(データソース名, Defaults(データソース名), Form1.Updates)
```

- `データソース名`は、実際に使用しているデータソースの名前に置き換えてください。
- `Form1`は、データを入力するフォームの名前に置き換えてください。

2. **下書きデータの読み込み**: アプリが起動するとき、もしくはユーザーが編集を再開するときに、保存された下書きデータをフォームに自動的に読み込むためのロジックを実装します。これを行うには、フォームの`OnVisible`プロパティまたはアプリの`OnStart`プロパティに式を設定し、下書きデータをフォームにロードするコードを記述します。

例えば、特定のユーザーIDに基づいて下書きデータをフィルタリングし、そのデータをフォームにロードする場合、以下のような式を使用できます。

```powerapps
If(
    Not(IsBlank(LookUp(データソース名, ユーザーID = User().Email))),
    Form1.Item = LookUp(データソース名, ユーザーID = User().Email),
    NewForm(Form1)
)
```

この例では、`LookUp`関数を使用して、ログイン中のユーザーに関連する下書きデータをデータソースから検索しています。見つかった場合は、そのデータをフォームに設定して編集を可能にし、見つからない場合は新しいフォームを開始します。

### 4. テストとデバッグ

下書き保存機能を実装したら、様々なシナリオでアプリをテストしてください。特に、以下の点に注意してテストを行います。

- ユーザーがフォームにデータを入力し、「保存」ボタンをクリックした後、データが正しくデータソースに保存されているか。
- アプリを再起動または再読み込みした時に、以前に保存された下書きデータが正しくフォームにロードされるか。
- 複数のユーザーが同時に異なる下書きデータを保存できるか。